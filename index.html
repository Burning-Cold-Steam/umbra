<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Poster</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700;800&family=Inter:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b0c10;
      --panel:rgba(255,255,255,.06);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.65);
      --border:rgba(255,255,255,.14);
      --shadow:0 10px 30px rgba(0,0,0,.55);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background:radial-gradient(1000px 700px at 30% 20%,#182033 0%,var(--bg) 55%);
      color:var(--text);
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .wrap{width:min(960px,94vw)}
    .card{
      background:linear-gradient(180deg,var(--panel),rgba(255,255,255,.03));
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* Desktop: feed-friendly */
    .poster{
      width:min(720px, 94vw);
      aspect-ratio:4/5;
      position:relative;
      background:rgba(0,0,0,.25);
      user-select:none;
      touch-action:none;
      overflow:hidden;
    }

    /* Mobile: tall story */
    @media(max-width:700px){
      .poster{
        width:min(96vw, 520px);
        aspect-ratio:9/16;
        max-height:92vh;
      }
    }

    /* Social-ish vignette + grade */
    .grade{
      position:absolute; inset:0; pointer-events:none; z-index:3;
      background:
        radial-gradient(120% 110% at 50% 45%, rgba(0,0,0,0.00) 45%, rgba(0,0,0,0.40) 100%),
        linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0.12));
    }
    .grain{
      position:absolute; inset:0; pointer-events:none; z-index:4;
      opacity:.08;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='180' height='180' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
      background-size:180px 180px;
    }

    /* Upload overlay */
    .uploadOverlay{
      position:absolute; inset:0;
      display:grid; place-items:center;
      padding:22px;
      background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.35));
      transition:opacity .25s ease, transform .25s ease;
      z-index:10;
    }
    .dropzone{
      width:min(520px,92%);
      border:1px dashed rgba(255,255,255,.25);
      border-radius:16px;
      padding:22px;
      text-align:center;
      background:rgba(255,255,255,.04);
    }
    .dropzone h2{margin:0 0 8px;font-size:18px;font-weight:750}
    .dropzone p{margin:0 0 14px;color:var(--muted);font-size:14px;line-height:1.35}
    .btnRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    button{
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.08);
      color:var(--text);
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:650;
      letter-spacing:.2px;
      font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    button:hover{background:rgba(255,255,255,.11)}
    button:active{transform:translateY(1px)}
    button:disabled{opacity:.55;cursor:not-allowed;transform:none}

    .stage{position:absolute; inset:0; overflow:hidden; z-index:1;}
    .stage img{
      position:absolute; left:50%; top:50%;
      transform-origin:center;
      max-width:none;
      pointer-events:none;
      -webkit-user-drag:none;
      filter: contrast(1.07) saturate(1.15) brightness(1.03) sepia(0.06);
    }

    .controls{
      position:absolute; top:14px; left:14px; right:14px;
      display:none; gap:10px; justify-content:flex-end; flex-wrap:wrap;
      z-index:20;
    }

    .dragHint{
      position:absolute; top:14px; left:14px;
      padding:8px 10px; border-radius:12px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.28);
      color:rgba(255,255,255,.78);
      font-size:12px;
      z-index:20;
      opacity:1;
      transition: opacity .35s ease;
    }
    .hintHidden .dragHint{opacity:0; pointer-events:none;}

    .affirmation{
      position:absolute; left:16px; right:16px; bottom:18px;
      padding:16px 18px;
      text-align:center;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.34);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
      z-index:30;

      opacity:0;
      transform:translateY(12px);
      transition:opacity .65s ease, transform .65s ease;
    }
    .affirmation .main{
      font-family:"Playfair Display", serif;
      font-size:clamp(26px,3.1vw,38px);
      font-weight:800;
      margin:0;
      line-height:1.12;
      letter-spacing:.2px;
    }
    .affirmation .sub{
      margin:8px 0 0;
      color:rgba(255,255,255,.78);
      font-size:13px;
      line-height:1.25;
    }

    .loaded .uploadOverlay{opacity:0;pointer-events:none;transform:scale(.985)}
    .loaded .controls{display:flex}
    .reveal .affirmation{opacity:1;transform:none}

    /* Retry appears after 20s */
    .retryHidden #retryBtn{display:none}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div id="poster" class="poster">
        <div class="stage">
          <img id="photo" alt="" />
        </div>

        <div class="grade"></div>
        <div class="grain"></div>

        <div class="controls">
          <button type="button" id="downloadPng" disabled>Download PNG</button>
          <button type="button" id="copyPng" disabled>Copy PNG</button>
          <button type="button" id="fitBtn" disabled>Fit</button>
          <button type="button" id="retryBtn" disabled>Retry</button>
        </div>

        <div class="dragHint" id="dragHint">Drag to reposition â€¢ Scroll/pinch to zoom</div>

        <div class="affirmation" aria-live="polite">
          <p class="main" id="affirmMain"></p>
          <p class="sub" id="affirmSub"></p>
        </div>

        <div class="uploadOverlay">
          <div class="dropzone" id="dropzone">
            <h2>Add your photo</h2>
            <p>Choose or drop an image. The message appears after the photo loads.</p>
            <div class="btnRow">
              <button type="button" id="chooseBtn">Choose image</button>
            </div>
            <input id="file" type="file" accept="image/*" hidden>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script>
    const poster = document.getElementById('poster');
    const photo = document.getElementById('photo');
    const file = document.getElementById('file');
    const chooseBtn = document.getElementById('chooseBtn');
    const dropzone = document.getElementById('dropzone');

    const affirmMain = document.getElementById('af
